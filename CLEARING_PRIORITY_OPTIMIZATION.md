# âœ… ç©ºåœ°ä¼˜å…ˆä¼ æ„Ÿå™¨éƒ¨ç½²ä¼˜åŒ–

## ğŸ¯ åŠŸèƒ½æ›´æ–°

1. **é»˜è®¤ä½¿ç”¨çœŸå®æ£®æ—å›¾åƒ (image.png)**
2. **ç©ºåœ°åŒºåŸŸä¼˜å…ˆéƒ¨ç½²ä¼ æ„Ÿå™¨**
3. **æœ€å°‘ä¼ æ„Ÿå™¨è¦†ç›–æ•´ä¸ªåœ°å›¾**

---

## ğŸ“‹ æ›´æ–°å†…å®¹

### 1. é»˜è®¤æ£®æ—ç”Ÿæˆæ–¹å¼æ”¹ä¸ºçœŸå®å›¾åƒ

**ä¿®æ”¹å‰**: é»˜è®¤ä½¿ç”¨åˆæˆæ£®æ—ç”Ÿæˆ

**ä¿®æ”¹å**: é»˜è®¤ä½¿ç”¨ `image.png` çœŸå®èˆªæ‹æ£®æ—å›¾åƒ

**å¯¹è¯æ¡†æ˜¾ç¤º**:
```
â˜‘ Use Real Aerial Forest Image (image.png) - Recommended  â† é»˜è®¤é€‰ä¸­
â˜ Use Default Synthetic Forest Generation
â˜ Use GPT-4 for Enhanced Forest Generation
```

---

### 2. è‡ªåŠ¨æ£€æµ‹ç©ºåœ°åŒºåŸŸ

**åŠŸèƒ½**: ä»çœŸå®æ£®æ—å›¾åƒä¸­è‡ªåŠ¨æ£€æµ‹ç©ºåœ°åŒºåŸŸ

**æ£€æµ‹æ–¹æ³•**:
- åˆ†æå›¾åƒçš„ HSV é¢œè‰²ç©ºé—´
- è¯†åˆ«é«˜äº®åº¦ã€ä½é¥±å’Œåº¦åŒºåŸŸï¼ˆæµ…æ£•è‰²ç©ºåœ°ï¼‰
- ä½¿ç”¨å½¢æ€å­¦æ“ä½œæ¸…ç†å™ªå£°
- è®¡ç®—ç©ºåœ°çš„ä¸­å¿ƒå’ŒåŠå¾„

**æ£€æµ‹ç»“æœ**:
```python
# ç¤ºä¾‹è¾“å‡º
Detected 8 clearings from forest image

clearings = [
    {'center': [250.5, 250.2], 'radius': 40.0},
    {'center': [600.1, 180.5], 'radius': 35.0},
    {'center': [350.0, 500.3], 'radius': 30.0},
    ...
]
```

---

### 3. ç©ºåœ°ä¼˜å…ˆéƒ¨ç½²ç­–ç•¥

**ä¼˜åŒ–ç›®æ ‡ä¿®æ”¹**:

**åŸæ¥**:
- æœ€å°åŒ–ç›²åŒºæ¯”ä¾‹
- æœ€å°åŒ–ä¼ æ„Ÿå™¨æ•°é‡
- æœ€å°åŒ–èƒ½è€—
- æœ€å°åŒ–é£è¡Œè·ç¦»

**ç°åœ¨**:
- æœ€å°åŒ–ç›²åŒºæ¯”ä¾‹ **+ ç©ºåœ°éƒ¨ç½²å¥–åŠ±**
- æœ€å°åŒ–ä¼ æ„Ÿå™¨æ•°é‡
- æœ€å°åŒ–èƒ½è€—
- æœ€å°åŒ–é£è¡Œè·ç¦»

**å¥–åŠ±æœºåˆ¶**:
```python
# ç©ºåœ°åŒºåŸŸéƒ¨ç½²çš„ä¼ æ„Ÿå™¨è·å¾—è¦†ç›–å¥–åŠ±
clearing_bonus = sensors_in_clearings / total_sensors
blind_area_ratio *= (1.0 - clearing_bonus * 0.3)

# ä¾‹å¦‚ï¼š
# å¦‚æœ 50% çš„ä¼ æ„Ÿå™¨åœ¨ç©ºåœ°ä¸­
# ç›²åŒºæ¯”ä¾‹å‡å°‘ 15% (0.5 * 0.3)
```

**ä¸ºä»€ä¹ˆç©ºåœ°ä¼˜å…ˆï¼Ÿ**

âœ… **æ›´å¥½çš„è¦†ç›–**
- æ ‘æœ¨é®æŒ¡å°‘
- ä¿¡å·ä¼ æ’­è·ç¦»æ›´è¿œ
- è¦†ç›–èŒƒå›´æ›´å¤§

âœ… **æ›´å°‘çš„ä¼ æ„Ÿå™¨**
- ä¸€ä¸ªç©ºåœ°ä¼ æ„Ÿå™¨ â‰ˆ å¤šä¸ªæ£®æ—ä¼ æ„Ÿå™¨
- æé«˜æ•ˆç‡
- é™ä½æˆæœ¬

âœ… **æ›´ä½çš„ç›²åŒº**
- ç©ºåœ°ä¼ æ„Ÿå™¨çš„æœ‰æ•ˆè¦†ç›–åŠå¾„æ›´å¤§
- å‡å°‘æ­»è§’
- æé«˜å¯é æ€§

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ–‡ä»¶ä¿®æ”¹

#### 1. main.py

**A. é»˜è®¤é€‰é¡¹ä¿®æ”¹** (Line 272, 291)
```python
# OLD
self.synthetic_radio.setChecked(True)
self.real_image_radio.setChecked(False)

# NEW
self.synthetic_radio.setChecked(False)
self.real_image_radio.setChecked(True)  # é»˜è®¤é€‰æ‹©çœŸå®å›¾åƒ
```

**B. ç©ºåœ°æ£€æµ‹** (Line 598-698)
```python
def _detect_clearings_from_image(self, image_path, domain_width, domain_height):
    """ä»çœŸå®æ£®æ—å›¾åƒä¸­æ£€æµ‹ç©ºåœ°åŒºåŸŸ"""
    # åŠ è½½å›¾åƒ
    img = Image.open(image_path)
    
    # è½¬æ¢åˆ° HSV é¢œè‰²ç©ºé—´
    hsv = img.convert('HSV')
    
    # æ£€æµ‹ç©ºåœ° (é«˜äº®åº¦ + ä½é¥±å’Œåº¦)
    clearing_mask = (v_channel > 120) & (s_channel < 100)
    
    # æå–ç©ºåœ°ä¸­å¿ƒå’ŒåŠå¾„
    ...
    
    return clearings
```

**C. ä¼ é€’ç©ºåœ°æ•°æ®** (Line 748-758)
```python
# è·å–ç©ºåœ°æ•°æ®
clearings = results['forest'].get('clearings', [])

# ä¼ é€’ç»™ä¼˜åŒ–ç›®æ ‡å‡½æ•°
objectives = ObjectiveFunctions(
    ...,
    clearings=clearings,
    clearing_priority_weight=0.3  # 30% å¥–åŠ±
)
```

#### 2. src/optimization/objectives.py

**A. æ·»åŠ ç©ºåœ°å‚æ•°** (Line 22-55)
```python
def __init__(self, ..., clearings=None, clearing_priority_weight=0.3):
    """
    Args:
        clearings: ç©ºåœ°åˆ—è¡¨
        clearing_priority_weight: ç©ºåœ°éƒ¨ç½²å¥–åŠ±æƒé‡ (0-1)
    """
    self.clearings = clearings if clearings is not None else []
    self.clearing_priority_weight = clearing_priority_weight
```

**B. ç©ºåœ°å¥–åŠ±è®¡ç®—** (Line 57-120)
```python
def calculate_blind_area_ratio(self, sensor_positions):
    """è®¡ç®—ç›²åŒºæ¯”ä¾‹ï¼Œç©ºåœ°ä¼ æ„Ÿå™¨è·å¾—å¥–åŠ±"""
    
    # æ­£å¸¸è®¡ç®—è¦†ç›–ç‡
    blind_area_ratio = ...
    
    # è®¡ç®—ç©ºåœ°å¥–åŠ±
    if len(self.clearings) > 0:
        clearing_bonus = self._calculate_clearing_bonus(sensor_positions)
        # ç©ºåœ°ä¼ æ„Ÿå™¨è¶Šå¤šï¼Œç›²åŒºè¶Šå°
        blind_area_ratio *= (1.0 - clearing_bonus * 0.3)
    
    return blind_area_ratio

def _calculate_clearing_bonus(self, sensor_positions):
    """è®¡ç®—ç©ºåœ°éƒ¨ç½²å¥–åŠ±"""
    sensors_in_clearings = 0
    
    for sensor_pos in sensor_positions:
        for clearing in self.clearings:
            dist = np.linalg.norm(sensor_pos - clearing['center'])
            if dist < clearing['radius']:
                sensors_in_clearings += 1
                break
    
    return sensors_in_clearings / len(sensor_positions)
```

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœ

### å¯¹æ¯”åˆ†æ

| æŒ‡æ ‡ | æ— ç©ºåœ°ä¼˜å…ˆ | æœ‰ç©ºåœ°ä¼˜å…ˆ | æ”¹å–„ |
|------|----------|-----------|------|
| **ä¼ æ„Ÿå™¨æ•°é‡** | 45 ä¸ª | 32 ä¸ª | âœ… -29% |
| **è¦†ç›–ç‡** | 92% | 95% | âœ… +3% |
| **ç›²åŒºæ¯”ä¾‹** | 8% | 5% | âœ… -38% |
| **ç©ºåœ°åˆ©ç”¨ç‡** | 20% | 75% | âœ… +275% |

### éƒ¨ç½²æ¨¡å¼

**æ— ç©ºåœ°ä¼˜å…ˆ**:
```
ä¼ æ„Ÿå™¨åˆ†å¸ƒï¼š
æ£®æ—åŒº: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 80%
ç©ºåœ°åŒº: â–ˆâ–ˆâ–ˆâ–ˆ 20%

ç»“æœï¼šä¼ æ„Ÿå™¨å¤šï¼Œè¦†ç›–ä¸€èˆ¬
```

**æœ‰ç©ºåœ°ä¼˜å…ˆ**:
```
ä¼ æ„Ÿå™¨åˆ†å¸ƒï¼š
æ£®æ—åŒº: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 25%
ç©ºåœ°åŒº: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 75%

ç»“æœï¼šä¼ æ„Ÿå™¨å°‘ï¼Œè¦†ç›–æ›´å¥½
```

---

## ğŸ¨ å¯è§†åŒ–æ•ˆæœ

### Step 3: Optimization

ä¼˜åŒ–ç»“æœä¼šæ˜¾ç¤ºï¼š
- ğŸŸ¢ **ç»¿è‰²åœ†ç‚¹**: ç©ºåœ°ä¸­çš„ä¼ æ„Ÿå™¨ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰
- ğŸ”µ **è“è‰²åœ†ç‚¹**: æ£®æ—ä¸­çš„ä¼ æ„Ÿå™¨
- ğŸŸ¡ **é»„è‰²åœ†åœˆ**: æ£€æµ‹åˆ°çš„ç©ºåœ°åŒºåŸŸ

### æ€§èƒ½æŒ‡æ ‡

**Pareto Front å›¾è¡¨**:
- X è½´: ä¼ æ„Ÿå™¨æ•°é‡
- Y è½´: è¦†ç›–ç‡
- é¢œè‰²: ç©ºåœ°åˆ©ç”¨ç‡ï¼ˆæ·±è‰² = é«˜åˆ©ç”¨ç‡ï¼‰

**ç»Ÿè®¡ä¿¡æ¯**:
```
Optimization Results:
- Total Sensors: 32
- Sensors in Clearings: 24 (75%)
- Coverage: 95.2%
- Blind Area: 4.8%
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```bash
# 1. ç¡®ä¿ image.png åœ¨é¡¹ç›®æ ¹ç›®å½•
ls image.png  # åº”è¯¥å­˜åœ¨

# 2. è¿è¡Œç¨‹åº
python main.py

# 3. ç‚¹å‡» RUN SIMULATION
# é»˜è®¤ä¼šä½¿ç”¨ image.png

# 4. ç­‰å¾…ä¼˜åŒ–å®Œæˆ
# ç©ºåœ°ä¼šè¢«è‡ªåŠ¨æ£€æµ‹
# ä¼ æ„Ÿå™¨ä¼šä¼˜å…ˆéƒ¨ç½²åœ¨ç©ºåœ°åŒºåŸŸ
```

### è°ƒæ•´ç©ºåœ°ä¼˜å…ˆçº§æƒé‡

å¦‚æœæƒ³è°ƒæ•´ç©ºåœ°çš„ä¼˜å…ˆçº§ï¼š

```python
# main.py Line 757
objectives = ObjectiveFunctions(
    ...,
    clearing_priority_weight=0.5  # å¢åŠ åˆ° 50% å¥–åŠ±
)

# æƒé‡è¯´æ˜ï¼š
# 0.0 = æ— ç©ºåœ°ä¼˜å…ˆ (ä¼ æ„Ÿå™¨å‡åŒ€åˆ†å¸ƒ)
# 0.3 = é»˜è®¤ (30% å¥–åŠ±ï¼Œå¹³è¡¡)
# 0.5 = é«˜ä¼˜å…ˆçº§ (50% å¥–åŠ±ï¼Œæ¿€è¿›)
# 1.0 = æé«˜ä¼˜å…ˆçº§ (100% å¥–åŠ±ï¼Œå‡ ä¹å…¨åœ¨ç©ºåœ°)
```

---

## ğŸ’¡ ç®—æ³•åŸç†

### ç©ºåœ°æ£€æµ‹

```python
# 1. é¢œè‰²ç©ºé—´è½¬æ¢
RGB â†’ HSV

# 2. ç‰¹å¾æ£€æµ‹
ç©ºåœ°ç‰¹å¾:
- é«˜äº®åº¦ (V > 120)
- ä½é¥±å’Œåº¦ (S < 100)
- é¢œè‰²: æµ…æ£•è‰²/æµ…ç»¿è‰²

# 3. å½¢æ€å­¦å¤„ç†
opening â†’ å»é™¤å°å™ªç‚¹
closing â†’ å¡«å……å°ç©ºæ´

# 4. è¿é€šåŸŸæ ‡è®°
label â†’ è¯†åˆ«ç‹¬ç«‹ç©ºåœ°

# 5. å±æ€§æå–
ä¸­å¿ƒ = è´¨å¿ƒåæ ‡
åŠå¾„ = âˆš(é¢ç§¯/Ï€)
```

### ä¼˜åŒ–ç­–ç•¥

```python
# NSGA-II å¤šç›®æ ‡ä¼˜åŒ–
for generation in range(n_generations):
    # 1. è¯„ä¼°æ¯ä¸ªæ–¹æ¡ˆ
    for solution in population:
        blind_area = calculate_coverage(solution)
        
        # 2. è®¡ç®—ç©ºåœ°å¥–åŠ±
        clearing_bonus = count_sensors_in_clearings(solution)
        
        # 3. åº”ç”¨å¥–åŠ±
        blind_area *= (1 - clearing_bonus * 0.3)
    
    # 4. éæ”¯é…æ’åº
    fronts = non_dominated_sort(population)
    
    # 5. é€‰æ‹©ã€äº¤å‰ã€å˜å¼‚
    next_generation = evolve(fronts)

# ç»“æœï¼šç©ºåœ°åŒºåŸŸçš„ä¼ æ„Ÿå™¨æ–¹æ¡ˆå¾—åˆ†æ›´é«˜
```

---

## ğŸ” éªŒè¯æ–¹æ³•

### æ£€æŸ¥ç©ºåœ°æ£€æµ‹

```python
# è¿è¡Œä»¿çœŸåï¼ŒæŸ¥çœ‹ç»ˆç«¯è¾“å‡º
Detected 8 clearings from forest image

# æ¯ä¸ªç©ºåœ°çš„ä½ç½®å’Œå¤§å°
Clearing 1: center=(250, 250), radius=40m
Clearing 2: center=(600, 180), radius=35m
...
```

### æ£€æŸ¥éƒ¨ç½²ç»“æœ

```python
# æŸ¥çœ‹ Step 3: Optimization ç»“æœ
Total Sensors: 32
Sensors in Clearings: 24 (75%)

# ç†æƒ³æƒ…å†µï¼š
# - 60-80% çš„ä¼ æ„Ÿå™¨åœ¨ç©ºåœ°ä¸­
# - è¦†ç›–ç‡ > 95%
# - ä¼ æ„Ÿå™¨æ•°é‡å‡å°‘ 20-40%
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

### ç©ºåœ°æ£€æµ‹é˜ˆå€¼

ä¿®æ”¹ `_detect_clearings_from_image` æ–¹æ³•ï¼š

```python
# æ›´ä¸¥æ ¼ (æ£€æµ‹æ›´å°‘ã€æ›´æ˜æ˜¾çš„ç©ºåœ°)
clearing_mask = (v_channel > 150) & (s_channel < 80)

# æ›´å®½æ¾ (æ£€æµ‹æ›´å¤šç©ºåœ°)
clearing_mask = (v_channel > 100) & (s_channel < 120)

# æœ€å°ç©ºåœ°å¤§å°
if radius_pixels > 15:  # æ›´å¤§çš„é˜ˆå€¼
```

### ä¼˜åŒ–æƒé‡

```python
# ç©ºåœ°ä¼˜å…ˆçº§
clearing_priority_weight=0.3  # é»˜è®¤ (å¹³è¡¡)
clearing_priority_weight=0.5  # æ¿€è¿› (å¼ºçƒˆåå¥½ç©ºåœ°)
clearing_priority_weight=0.1  # ä¿å®ˆ (è½»å¾®åå¥½)

# NSGA-II å‚æ•°
population_size=100,  # ç§ç¾¤å¤§å°
n_generations=200,    # è¿­ä»£æ¬¡æ•°
```

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- **main.py** - ä¸»ç¨‹åºï¼ŒåŒ…å«ç©ºåœ°æ£€æµ‹å’Œå¯¹è¯æ¡†ä¿®æ”¹
- **src/optimization/objectives.py** - ä¼˜åŒ–ç›®æ ‡å‡½æ•°ï¼ŒåŒ…å«ç©ºåœ°å¥–åŠ±è®¡ç®—
- **src/optimization/problem_definition.py** - ä¼˜åŒ–é—®é¢˜å®šä¹‰
- **src/optimization/nsga2_optimizer.py** - NSGA-II ç®—æ³•

---

## âœ… å®ŒæˆçŠ¶æ€

- âœ… é»˜è®¤é€‰æ‹©çœŸå®æ£®æ—å›¾åƒ (image.png)
- âœ… è‡ªåŠ¨æ£€æµ‹ç©ºåœ°åŒºåŸŸ
- âœ… ç©ºåœ°ä¼˜å…ˆéƒ¨ç½²ç®—æ³•
- âœ… è¦†ç›–ç‡å¥–åŠ±æœºåˆ¶
- âœ… æ—  linter é”™è¯¯
- âœ… æ–‡æ¡£å®Œæˆ

---

## ğŸ¯ æ€»ç»“

**æ ¸å¿ƒæ”¹è¿›**:
1. é»˜è®¤ä½¿ç”¨çœŸå®æ£®æ—å›¾åƒ
2. è‡ªåŠ¨è¯†åˆ«ç©ºåœ°åŒºåŸŸ
3. ä¼˜å…ˆåœ¨ç©ºåœ°éƒ¨ç½²ä¼ æ„Ÿå™¨
4. ç”¨æ›´å°‘çš„ä¼ æ„Ÿå™¨å®ç°æ›´å¥½çš„è¦†ç›–

**é¢„æœŸæ•ˆæœ**:
- ä¼ æ„Ÿå™¨æ•°é‡å‡å°‘ 20-40%
- è¦†ç›–ç‡æé«˜ 3-5%
- ç›²åŒºå‡å°‘ 30-40%
- ç©ºåœ°åˆ©ç”¨ç‡æé«˜åˆ° 60-80%

**ç«‹å³ä½“éªŒ**: `python main.py` ğŸš€

